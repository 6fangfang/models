2023-09-06 12:33:10,437 - INFO - Log directory: /home/zhangwt/M-Libcity/M_libcity/log
2023-09-06 12:33:10,438 - INFO - Begin pipeline, task=eta, model_name=DeepTTE, dataset_name=Beijing_Taxi_Sample, exp_id=51370
2023-09-06 12:33:10,438 - INFO - {'task': 'eta', 'model': 'DeepTTE', 'dataset': 'Beijing_Taxi_Sample', 'saved_model': True, 'train': True, 'rank_size': 1, 'dataset_class': 'ETADataset', 'eta_encoder': 'DeeptteEncoder', 'executor': 'ETAExecutor', 'evaluator': 'ETAEvaluator', 'uid_emb_size': 16, 'weekid_emb_size': 3, 'timdid_emb_size': 8, 'kernel_size': 3, 'num_filter': 32, 'pooling_method': 'attention', 'num_final_fcs': 4, 'final_fc_size': 128, 'alpha': 0.1, 'rnn_type': 'LSTM', 'rnn_num_layers': 1, 'hidden_size': 128, 'max_epoch': 100, 'batch_size': 10, 'learner': 'adam', 'learning_rate': 0.001, 'lr_decay': False, 'clip_grad_norm': False, 'use_early_stop': False, 'patience': 20, 'num_workers': 1, 'min_session_len': 5, 'max_session_len': 50, 'min_sessions': 0, 'window_size': 1, 'cut_method': 'time_interval', 'pad_with_last_sample': True, 'sort_by_traj_len': True, 'cache_dataset': True, 'train_rate': 0.7, 'eval_rate': 0.1, 'gpu': True, 'gpu_id': 0, 'train_loss': 'none', 'epoch': 0, 'weight_decay': 0, 'lr_epsilon': 1e-08, 'lr_beta1': 0.9, 'lr_beta2': 0.999, 'lr_alpha': 0.99, 'lr_momentum': 0, 'lr_scheduler': 'multisteplr', 'lr_decay_ratio': 0.1, 'steps': [5, 20, 40, 70], 'step_size': 10, 'lr_T_max': 30, 'lr_eta_min': 0, 'lr_patience': 10, 'lr_threshold': 0.0001, 'max_grad_norm': 1.0, 'log_level': 'INFO', 'log_every': 1, 'load_best_epoch': True, 'hyper_tune': False, 'metrics': ['MAE', 'MAPE', 'MSE', 'RMSE', 'masked_MAE', 'masked_MAPE', 'masked_MSE', 'masked_RMSE', 'R2', 'EVAR'], 'mode': 'single', 'save_modes': ['csv'], 'geo': {'including_types': ['Polygon'], 'Polygon': {'coordinates': 'coordinate', 'embedding': 'other'}}, 'usr': {'properties': {}}, 'dyna': {'including_types': ['trajectory'], 'trajectory': {'entity_id': 'usr_id', 'traj_id': 'num', 'coordinates': 'coordinate', 'current_dis': 'num', 'speeds': 'other', 'speeds_relevant1': 'other', 'speeds_relevant2': 'other', 'speeds_long': 'other', 'grid_len': 'num', 'holiday': 'num'}}, 'geo_file': 'Beijing_Taxi_Sample', 'usr_file': 'Beijing_Taxi_Sample', 'dyna_file': 'Beijing_Taxi_Sample', 'exp_id': 51370}
2023-09-06 12:33:11,423 - INFO - Loading file /home/zhangwt/M-Libcity/M_libcity/cache/dataset_cache/eta_Beijing_Taxi_Sample_DeeptteEncoder.json
2023-09-06 12:33:11,841 - INFO - longi_mean: 116.38167145561566
2023-09-06 12:33:11,842 - INFO - longi_std: 0.07416283805701834
2023-09-06 12:33:11,842 - INFO - lati_mean: 39.92553892677388
2023-09-06 12:33:11,842 - INFO - lati_std: 0.049981772271572
2023-09-06 12:33:11,842 - INFO - dist_mean: 8.814695989840317
2023-09-06 12:33:11,842 - INFO - dist_std: 7.073727325486173
2023-09-06 12:33:11,842 - INFO - time_mean: 1166.8956065318819
2023-09-06 12:33:11,842 - INFO - time_std: 973.9645727168944
2023-09-06 12:33:11,842 - INFO - dist_gap_mean: 0.3897806752549975
2023-09-06 12:33:11,842 - INFO - dist_gap_std: 0.22667483085183782
2023-09-06 12:33:11,842 - INFO - time_gap_mean: 51.59943780140807
2023-09-06 12:33:11,842 - INFO - time_gap_std: 44.83032982709822
2023-09-06 12:33:11,880 - INFO - Number of train data: 15432
2023-09-06 12:33:11,880 - INFO - Number of eval  data: 2200
2023-09-06 12:33:11,880 - INFO - Number of test  data: 4368
2023-09-06 12:33:12,419 - INFO - DeepTTE<
  (network): DeepTTE_model<
    (attr_net): Attr<
      (uid_em): Embedding<vocab_size=4968, embedding_size=16, use_one_hot=False, embedding_table=Parameter (name=network.attr_net.uid_em.embedding_table, shape=(4968, 16), dtype=Float32, requires_grad=True), dtype=Float32, padding_idx=None>
      (weekid_em): Embedding<vocab_size=7, embedding_size=3, use_one_hot=False, embedding_table=Parameter (name=network.attr_net.weekid_em.embedding_table, shape=(7, 3), dtype=Float32, requires_grad=True), dtype=Float32, padding_idx=None>
      (timeid_em): Embedding<vocab_size=1440, embedding_size=8, use_one_hot=False, embedding_table=Parameter (name=network.attr_net.timeid_em.embedding_table, shape=(1440, 8), dtype=Float32, requires_grad=True), dtype=Float32, padding_idx=None>
      >
    (spatio_temporal): SpatioTemporal<
      (geo_conv): GeoConv<
        (state_em): Embedding<vocab_size=2, embedding_size=2, use_one_hot=False, embedding_table=Parameter (name=network.spatio_temporal.geo_conv.state_em.embedding_table, shape=(2, 2), dtype=Float32, requires_grad=True), dtype=Float32, padding_idx=None>
        (process_coords): Dense<input_channels=4, output_channels=16, has_bias=True>
        (conv): Conv1d<input_channels=16, output_channels=32, kernel_size=(1, 3), stride=(1, 1), pad_mode=pad, padding=(0, 0, 0, 0), dilation=(1, 1), group=1, has_bias=False, weight_init=normal, bias_init=zeros>
        >
      (rnn): LSTM<
        (rnn): _DynamicLSTMCPUGPU<>
        (dropout_op): Dropout<keep_prob=1.0>
        >
      (attr2atten): Dense<input_channels=28, output_channels=128, has_bias=True>
      >
    (entire_estimate): EntireEstimator<
      (input2hid): Dense<input_channels=156, output_channels=128, has_bias=True>
      (residuals): CellList<
        (0): Dense<input_channels=128, output_channels=128, has_bias=True>
        (1): Dense<input_channels=128, output_channels=128, has_bias=True>
        (2): Dense<input_channels=128, output_channels=128, has_bias=True>
        (3): Dense<input_channels=128, output_channels=128, has_bias=True>
        >
      (hid2out): Dense<input_channels=128, output_channels=1, has_bias=True>
      >
    (local_estimate): LocalEstimator<
      (input2hid): Dense<input_channels=128, output_channels=64, has_bias=True>
      (hid2hid): Dense<input_channels=64, output_channels=32, has_bias=True>
      (hid2out): Dense<input_channels=32, output_channels=1, has_bias=True>
      >
    >
  >
2023-09-06 12:33:12,420 - INFO - network.attr_net.uid_em.embedding_table	(4968, 16)	True
2023-09-06 12:33:12,420 - INFO - network.attr_net.weekid_em.embedding_table	(7, 3)	True
2023-09-06 12:33:12,420 - INFO - network.attr_net.timeid_em.embedding_table	(1440, 8)	True
2023-09-06 12:33:12,420 - INFO - network.spatio_temporal.geo_conv.state_em.embedding_table	(2, 2)	True
2023-09-06 12:33:12,420 - INFO - network.spatio_temporal.geo_conv.process_coords.weight	(16, 4)	True
2023-09-06 12:33:12,420 - INFO - network.spatio_temporal.geo_conv.process_coords.bias	(16,)	True
2023-09-06 12:33:12,420 - INFO - network.spatio_temporal.geo_conv.conv.weight	(32, 16, 1, 3)	True
2023-09-06 12:33:12,420 - INFO - network.spatio_temporal.rnn.weight_ih_l0	(512, 61)	True
2023-09-06 12:33:12,420 - INFO - network.spatio_temporal.rnn.weight_hh_l0	(512, 128)	True
2023-09-06 12:33:12,421 - INFO - network.spatio_temporal.rnn.bias_ih_l0	(512,)	True
2023-09-06 12:33:12,421 - INFO - network.spatio_temporal.rnn.bias_hh_l0	(512,)	True
2023-09-06 12:33:12,421 - INFO - network.spatio_temporal.attr2atten.weight	(128, 28)	True
2023-09-06 12:33:12,421 - INFO - network.spatio_temporal.attr2atten.bias	(128,)	True
2023-09-06 12:33:12,421 - INFO - network.entire_estimate.input2hid.weight	(128, 156)	True
2023-09-06 12:33:12,421 - INFO - network.entire_estimate.input2hid.bias	(128,)	True
2023-09-06 12:33:12,421 - INFO - network.entire_estimate.residuals.0.weight	(128, 128)	True
2023-09-06 12:33:12,421 - INFO - network.entire_estimate.residuals.0.bias	(128,)	True
2023-09-06 12:33:12,421 - INFO - network.entire_estimate.residuals.1.weight	(128, 128)	True
2023-09-06 12:33:12,421 - INFO - network.entire_estimate.residuals.1.bias	(128,)	True
2023-09-06 12:33:12,421 - INFO - network.entire_estimate.residuals.2.weight	(128, 128)	True
2023-09-06 12:33:12,421 - INFO - network.entire_estimate.residuals.2.bias	(128,)	True
2023-09-06 12:33:12,421 - INFO - network.entire_estimate.residuals.3.weight	(128, 128)	True
2023-09-06 12:33:12,421 - INFO - network.entire_estimate.residuals.3.bias	(128,)	True
2023-09-06 12:33:12,421 - INFO - network.entire_estimate.hid2out.weight	(1, 128)	True
2023-09-06 12:33:12,421 - INFO - network.entire_estimate.hid2out.bias	(1,)	True
2023-09-06 12:33:12,421 - INFO - network.local_estimate.input2hid.weight	(64, 128)	True
2023-09-06 12:33:12,421 - INFO - network.local_estimate.input2hid.bias	(64,)	True
2023-09-06 12:33:12,422 - INFO - network.local_estimate.hid2hid.weight	(32, 64)	True
2023-09-06 12:33:12,422 - INFO - network.local_estimate.hid2hid.bias	(32,)	True
2023-09-06 12:33:12,422 - INFO - network.local_estimate.hid2out.weight	(1, 32)	True
2023-09-06 12:33:12,422 - INFO - network.local_estimate.hid2out.bias	(1,)	True
2023-09-06 12:33:12,422 - INFO - Total parameter numbers: 290795
2023-09-06 12:33:12,422 - INFO - You select `adam` optimizer.
2023-09-06 12:33:12,461 - WARNING - Received none train loss func and will use the loss func defined in the model.
2023-09-06 12:33:12,461 - INFO - Start training ...
2023-09-06 12:33:12,462 - INFO - num_batches:1543
2023-09-06 12:40:26,862 - INFO - valid loss 为: 0.2909124493598938
2023-09-06 12:48:35,577 - INFO - valid loss 为: 0.3024212121963501
2023-09-06 12:55:48,165 - INFO - valid loss 为: 0.2889043092727661
2023-09-06 13:02:29,880 - INFO - valid loss 为: 0.24161675572395325
2023-09-06 13:09:05,192 - INFO - valid loss 为: 0.2348378300666809
2023-09-06 13:15:41,891 - INFO - valid loss 为: 0.21663478016853333
2023-09-06 13:22:18,946 - INFO - valid loss 为: 0.22138015925884247
2023-09-06 13:28:58,882 - INFO - valid loss 为: 0.1995759755373001
2023-09-06 13:35:33,845 - INFO - valid loss 为: 0.20815300941467285
2023-09-06 13:42:10,547 - INFO - valid loss 为: 0.19665274024009705
2023-09-06 13:48:48,269 - INFO - valid loss 为: 0.19638845324516296
2023-09-06 13:55:33,286 - INFO - valid loss 为: 0.19877316057682037
2023-09-06 14:02:13,897 - INFO - valid loss 为: 0.2043403685092926
2023-09-06 14:08:56,324 - INFO - valid loss 为: 0.19710059463977814
2023-09-06 14:15:33,395 - INFO - valid loss 为: 0.1937333047389984
2023-09-06 14:22:04,545 - INFO - valid loss 为: 0.20499655604362488
2023-09-06 14:28:34,933 - INFO - valid loss 为: 0.20844286680221558
2023-09-06 14:35:03,414 - INFO - valid loss 为: 0.21880756318569183
2023-09-06 14:41:36,221 - INFO - valid loss 为: 0.209297776222229
2023-09-06 14:48:23,046 - INFO - valid loss 为: 0.21587549149990082
2023-09-06 14:55:10,659 - INFO - valid loss 为: 0.214891716837883
2023-09-06 15:01:39,544 - INFO - valid loss 为: 0.20430366694927216
2023-09-06 15:08:25,217 - INFO - valid loss 为: 0.21087701618671417
2023-09-06 15:15:08,210 - INFO - valid loss 为: 0.2719244658946991
2023-09-06 15:21:49,748 - INFO - valid loss 为: 0.2347044199705124
2023-09-06 15:28:32,163 - INFO - valid loss 为: 0.23836208879947662
2023-09-06 15:35:16,927 - INFO - valid loss 为: 0.23108749091625214
2023-09-06 15:41:50,072 - INFO - valid loss 为: 0.20060855150222778
2023-09-06 15:48:16,306 - INFO - valid loss 为: 0.22275252640247345
2023-09-06 15:55:09,430 - INFO - valid loss 为: 0.2062615156173706
2023-09-06 16:01:45,267 - INFO - valid loss 为: 0.23076188564300537
2023-09-06 16:08:14,723 - INFO - valid loss 为: 0.20318154990673065
2023-09-06 16:14:43,783 - INFO - valid loss 为: 0.2158714085817337
2023-09-06 16:21:13,944 - INFO - valid loss 为: 0.20697791874408722
2023-09-06 16:28:02,286 - INFO - valid loss 为: 0.2082224041223526
2023-09-06 16:34:49,017 - INFO - valid loss 为: 0.20583555102348328
2023-09-06 16:41:15,308 - INFO - valid loss 为: 0.21939606964588165
2023-09-06 16:47:48,709 - INFO - valid loss 为: 0.20827262103557587
2023-09-06 16:54:28,506 - INFO - valid loss 为: 0.20705798268318176
2023-09-06 17:01:09,096 - INFO - valid loss 为: 0.22240228950977325
2023-09-06 17:08:00,668 - INFO - valid loss 为: 0.23058965802192688
2023-09-06 17:14:24,849 - INFO - valid loss 为: 0.21014153957366943
2023-09-06 17:20:49,893 - INFO - valid loss 为: 0.22031603753566742
2023-09-06 17:27:22,660 - INFO - valid loss 为: 0.2277463972568512
2023-09-06 17:33:52,775 - INFO - valid loss 为: 0.22759149968624115
2023-09-06 17:40:22,381 - INFO - valid loss 为: 0.2163809984922409
2023-09-06 17:47:00,972 - INFO - valid loss 为: 0.21491171419620514
2023-09-06 17:53:36,202 - INFO - valid loss 为: 0.22876079380512238
2023-09-06 18:00:25,221 - INFO - valid loss 为: 0.26369282603263855
2023-09-06 18:07:28,033 - INFO - valid loss 为: 0.22513186931610107
2023-09-06 18:14:20,462 - INFO - valid loss 为: 0.20804083347320557
2023-09-06 18:21:11,347 - INFO - valid loss 为: 0.2253090888261795
2023-09-06 18:27:47,362 - INFO - valid loss 为: 0.22344814240932465
2023-09-06 18:34:37,369 - INFO - valid loss 为: 0.21575237810611725
2023-09-06 18:41:42,607 - INFO - valid loss 为: 0.22580944001674652
2023-09-06 18:48:25,282 - INFO - valid loss 为: 0.21496109664440155
2023-09-06 18:55:08,229 - INFO - valid loss 为: 0.23348139226436615
2023-09-06 19:01:47,620 - INFO - valid loss 为: 0.22675515711307526
2023-09-06 19:08:31,357 - INFO - valid loss 为: 0.21437197923660278
2023-09-06 19:15:15,802 - INFO - valid loss 为: 0.22376300394535065
2023-09-06 19:21:59,638 - INFO - valid loss 为: 0.23118972778320312
2023-09-06 19:28:44,055 - INFO - valid loss 为: 0.2262616753578186
2023-09-06 19:35:30,006 - INFO - valid loss 为: 0.2741190791130066
2023-09-06 19:42:15,764 - INFO - valid loss 为: 0.2227148562669754
2023-09-06 19:48:59,504 - INFO - valid loss 为: 0.21586865186691284
2023-09-06 19:55:46,879 - INFO - valid loss 为: 0.2376784235239029
2023-09-06 20:02:34,430 - INFO - valid loss 为: 0.2190839946269989
2023-09-06 20:09:22,801 - INFO - valid loss 为: 0.23947590589523315
2023-09-06 20:16:14,288 - INFO - valid loss 为: 0.2516993582248688
2023-09-06 20:23:05,454 - INFO - valid loss 为: 0.21543510258197784
2023-09-06 20:29:55,602 - INFO - valid loss 为: 0.217193603515625
2023-09-06 20:36:45,071 - INFO - valid loss 为: 0.218367338180542
2023-09-06 20:43:29,772 - INFO - valid loss 为: 0.2532973885536194
2023-09-06 20:50:16,798 - INFO - valid loss 为: 0.2365105301141739
2023-09-06 20:57:05,235 - INFO - valid loss 为: 0.2365221381187439
2023-09-06 21:03:48,851 - INFO - valid loss 为: 0.23157605528831482
2023-09-06 21:10:35,326 - INFO - valid loss 为: 0.2310832291841507
2023-09-06 21:17:23,614 - INFO - valid loss 为: 0.21920059621334076
2023-09-06 21:24:06,227 - INFO - valid loss 为: 0.2255578339099884
2023-09-06 21:30:54,456 - INFO - valid loss 为: 0.22936171293258667
2023-09-06 21:37:44,995 - INFO - valid loss 为: 0.245059996843338
2023-09-06 21:44:37,867 - INFO - valid loss 为: 0.22868187725543976
2023-09-06 21:51:23,847 - INFO - valid loss 为: 0.22184181213378906
2023-09-06 21:58:12,309 - INFO - valid loss 为: 0.22460997104644775
2023-09-06 22:05:01,014 - INFO - valid loss 为: 0.25005042552948
2023-09-06 22:11:49,631 - INFO - valid loss 为: 0.2252178192138672
2023-09-06 22:18:36,741 - INFO - valid loss 为: 0.22370126843452454
2023-09-06 22:25:23,800 - INFO - valid loss 为: 0.24030272662639618
2023-09-06 22:32:11,564 - INFO - valid loss 为: 0.27058592438697815
2023-09-06 22:38:56,747 - INFO - valid loss 为: 0.23150572180747986
2023-09-06 22:45:39,251 - INFO - valid loss 为: 0.2236730009317398
2023-09-06 22:52:20,736 - INFO - valid loss 为: 0.23624293506145477
2023-09-06 22:59:01,586 - INFO - valid loss 为: 0.22475992143154144
2023-09-06 23:05:48,508 - INFO - valid loss 为: 0.24116623401641846
2023-09-06 23:12:33,668 - INFO - valid loss 为: 0.23278287053108215
2023-09-06 23:19:20,038 - INFO - valid loss 为: 0.22734935581684113
2023-09-06 23:26:05,893 - INFO - valid loss 为: 0.24100057780742645
2023-09-06 23:32:53,031 - INFO - valid loss 为: 0.23714891076087952
2023-09-06 23:39:38,186 - INFO - valid loss 为: 0.22803784906864166
2023-09-06 23:46:27,391 - INFO - valid loss 为: 0.22759151458740234
2023-09-06 23:46:27,790 - INFO - Loaded model at /home/zhangwt/M-Libcity/M_libcity/cache/51370/model_cache/DeepTTE_Beijing_Taxi_Sample.ckpt
2023-09-06 23:46:27,821 - INFO - Start evaluating ...
2023-09-06 23:47:37,154 - INFO - Evaluate result is saved at /home/zhangwt/M-Libcity/M_libcity/cache/51370/evaluate_cache/2023_09_06_23_47_37_DeepTTE_Beijing_Taxi_Sample.csv
2023-09-06 23:47:37,172 - INFO - 
      MAE       RMSE
1  214.45218  333.43512
